# 一：设计大纲：

## 1.p2p网络：

采用完全图模型，每个节点都维护有网络内所有节点的ip(加端口号)。
具体细节如下：
1.当一笔交易向全网广播后，收到广播的节点将交易纳入交易池。
2.flask应用是单线程的，会对受到的请求按顺序进行响应。
3.当一个节点封装好一个区块以后，他会向全网进行广播，其余节点会验证他的有效性， 如果这条链比它自己的要长，它会转而在这条链上工作。
4.新的节点加入网络时，它会向全网广播自己的ip（加端口号），并随机选择一个节点下载区块链。
5.节点收到入网请求后，会在自己维护的节点列表中添加新入网节点的ip（加端口号）

## 2.并发问题：

一个节点有两个线程，一个启动Flask，负责与外界沟通，另一个则默默无闻地挖矿。
在发生区块链发生变动、交易池被更新等事件前，相应的资源会被上锁。

## 3.共识机制：

采用工作量证明：计算出合适的proof，使得sha256(sha256(区块)) 的16进制下前导零个数 >= 当前difficulty

## 4.区块的结构：

目前并不区分区块与区块头，也未引入默克尔树。
block的结构如下：
{
'index':在区块链中的位置,
'time': unix时间戳,
'transactions':是一个包含了交易记录的字典数组,
'proof': 工作量证明，
‘parentHash’:父节点的散列值
}

## 5.待实现的：

数字签名、默克尔树。



# 二：运行



## 1.启动矿机

在项目路径下打开命令行，

输入

```shell
python app.py 8300
```

即可运行第一台矿机。

输入

```shell
python app.py 8301
```

即可运行第二台矿机（至多可以有10台矿机一同工作。）矿机之间的沟通是自发的，不需要人工干预。

## 2.转账

如果需要转账，可以向任意一台矿机发送POST请求。

地址格式：

​		http://矿机地址/transactions/new

消息体格式：

```json
{
  "fr": "mark",
  "to": "abby",
  "amount": 2
}
```

像这样：

![image-20231108214735672](C:\Users\73921\AppData\Roaming\Typora\typora-user-images\image-20231108214735672.png)



